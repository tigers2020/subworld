{% extends 'base/base.html' %}
{% load sub_extras %}
{% load static %}
{% block keywords %}
    {% for keyword in keywords %}{% for key in keyword.keywords %}{{ key.name }}, {% endfor %}{% endfor %}
{% endblock %}
{% block body %}
{{ locator }}
    <section class="carousel" id="popular_header">
        <div class="row">
            <div class="col-4 pr-0">
                <div class="list-group" id="list-tab" role="tablist">
                    {% for now in nowplaying %}
                        <a class="list-group-item list-group-item-action {% if forloop.first %}active{% endif %}"
                           id="list_{{ now.id }}_list" data-toggle="list" href="#list_{{ now.id }}"
                           role="tab" aria-controls="{{ now.title }}">{{ now.title }}<br/>
                            <small>{{ now.original_title }} </small>
                        </a>
                    {% endfor %}
                </div>
            </div>
            <div class="col-8 pl-0">
                <div class="tab-content p-0" id="nav-tabContent">
                    {% for now in nowplaying %}
                        <div class="tab-pane fade {% if forloop.first %}active show{% endif %}"
                             id="list_{{ now.id }}" role="tabpanel"
                             aria-labelledby="list_{{ now.id }}_list">
                            <div class="jarallax">
                                <img class="jarallax-img lazy" src="{% static 'main/img/lightbox/loading.gif' %}"
                                     data-src="{{ image_url.base_url }}/{{ backdrop_size.w1280 }}{{ now.backdrop_path }}"
                                     alt="{{ now.title }}">
                                <div class="container flex-center text-left">
                                    <!-- First column -->
                                    <div class="col-md-3">
                                        <!-- Image -->
                                        <div class="z-depth-1">
                                            <img src="{% static 'main/img/lightbox/loading.gif' %}"
                                                 data-src="{{ image_url.base_url }}/{{ poster_size.w185 }}{{ now.poster_path }}"
                                                 class="img-fluid z-depth-1 lazy" alt="Post Image">
                                            <div class="mask rgba-white-slight"></div>

                                        </div>
                                        <!-- Image -->
                                    </div>
                                    <!-- First column -->
                                    <!-- Second column -->
                                    <div class="col-md-9">
                                        <!-- Excerpt -->
                                        <h3 class="h3-responsive text-uppercase mb-3 font-weight-bold">
                                            <a href="#" class="text-white mt-3"
                                               style="text-shadow: 2px 2px 8px #000000">{{ now.title }}</a>
                                            <span class="badge badge-danger product mb-4 ml-xl-0 ml-4">{{ now.release_date }}</span>
                                        </h3>
                                        <div class="progress md-progress" style="height: 20px">
                                            <div class="progress-bar" role="progressbar"
                                                 style="width: {{ now.vote_average|multiply:10 }}%; height: 20px"
                                                 aria-valuenow="{{ now.vote_average }}" aria-valuemin="0"
                                                 aria-valuemax="10">{{ now.vote_average|multiply:10 }}</div>
                                        </div>
                                        <p>{% for genre_id in now.genre_ids %}
                                            <a class="btn btn-light-blue"
                                               href="#">{{ genre_id|get_genre }}</a>
                                        {% endfor %}
                                        </p>
                                        <p class="grey-text-3 text-justify rgba-black-strong text-white p-3"
                                           style="height: 150px;">{{ now.overview|truncatechars:255 }}</p>
                                        <a href="{% url 'movie_detail' now.id %}" class="btn btn-primary">Read More</a>

                                        <!-- Excerpt -->
                                    </div>
                                </div>
                                <!-- Second column -->
                            </div>
                        </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </section>
    <section class="p-5" id="searchbar">
        <!-- Search form -->
        <form class="form-inline md-form form-sm active-cyan-2 mt-2" action="{% url 'search' %}">
            <label class="mdb-main-label">Label example</label>
            <input class="form-control form-control-sm mr-3 w-75" type="text" id="main_search" name="search"
                   placeholder="Search"
                   aria-label="Search">
            <button type="submit" class="btn btn-action"><i class="fas fa-search" aria-hidden="true"></i></button>
        </form>
    </section>
    <section>
        <div class="row">
            <div class="col-md-8">
                <div class="container">
                    <div class="row">
                        {% for popular in populars.results %}
                            <!-- Image overlay card -->
                            <div class="col-sm-4  col-md-3 col-lg-2 mt-3">
                                <div class="card card-image">
                                    <div class="view overlay zoom">
                                        <img class="card-img-top lazy"
                                             src="{% static 'main/img/lightbox/loading.gif' %}"
                                             data-src="{{ image_url.base_url }}/{{ poster_size.w185 }}{{ popular.poster_path }}"
                                             alt="{{ popular.title }}">
                                        <a href="{% url 'movie_detail' popular.id %}">
                                            <div class="mask rgba-white-slight"></div>
                                        </a>
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                </div>
                <nav aria-label="Page navigation example">
                    <ul class="pagination pg-blue justify-content-center">
                        <li class="page-item disabled">
                            <a class="page-link" tabindex="-1">Previous</a>
                        </li>
                        {% for page  in pop_pages %}
                            {% if forloop.first %}
                                <li class="page-item"><a class="page-link {% if request.GET.page %}active{% endif %}"
                                                         href="?page={{ page }}">{{ page }}</a></li>
                                ...
                            {% elif page > page_lead_in and page < page_lead_out %}
                                <li class="page-item"><a class="page-link {% if request.GET.page %}active{% endif %}"
                                                         href="?page={{ page }}">{{ page }}</a></li>
                            {% elif forloop.last %}
                                ...
                                <li class="page-item"><a class="page-link {% if request.GET.page %}active{% endif %}"
                                                         href="?page={{ page }}">{{ page }}</a></li>
                            {% endif %}

                        {% endfor %}
                        <li class="page-item">
                            <a class="page-link">Next</a>
                        </li>
                    </ul>
                </nav>
            </div>
            <div class="col-md-4">
                <h4>Resent Subtitles</h4>
                <div class="list-group">
                    {% for subtitle in subtitles %}
                        <a href="{% url 'movie_detail'  subtitle.db_id %}"
                           class="list-group-item list-group-item-action">
                            <div class="row">
                                <div class="col-9">
                                    <i class="{{ subtitle.language.iso_language_name }} flag"></i>

                                    {{ subtitle.title }}<span
                                        class="badge-info">{{ subtitle.upload_date.year }}</span>
                                </div>
                                <div class="text-right badge-success col-3">{{ subtitle.user }}</div>
                            </div>
                        </a>
                    {% endfor %}
                </div>
            </div>
        </div>
    </section>
{% endblock %}

{% block script %}
    <script>
        // Material Select Initialization
        $(document).ready(function () {
            $('.mdb-select').materialSelect();
        });

        $(function () {
            $('.min-chart#chart-vote').easyPieChart({
                barColor: "#4caf50",
                onStep: function (from, to, percent) {
                    $(this.el).find('.percent').text(Math.round(percent));
                }
            });
        });

        // object-fit polyfill run
        objectFitImages();

        /* init Jarallax */
        jarallax(document.querySelectorAll('.jarallax'));

        jarallax(document.querySelectorAll('.jarallax-keep-img'), {
            keepImg: true,
        });
    </script>
    <script>
        $(function () {
            $("#video_search").autocomplete({
                source: "{% url 'autocomplete' %}",
                minLength: 2,
            });
        });
    </script>
{% endblock %}